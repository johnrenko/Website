---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import WorkCard from "../../components/WorkCard.astro";
import { t } from '../../i18n/t.js';
import type { Locale } from '../../i18n/config.js';

export interface Props {
  locale: Locale;
}

const { locale } = Astro.props;

const works = await getCollection('work');
const sortedWorks = works
  .filter(work => work.data.locale === locale)
  .slice()
  .sort((a, b) => {
    const orderA = typeof a.data.order === 'number' ? a.data.order : Number.POSITIVE_INFINITY;
    const orderB = typeof b.data.order === 'number' ? b.data.order : Number.POSITIVE_INFINITY;
    if (orderA !== orderB) return orderA - orderB; // lower order first
    // Fallback: most recent date first (date is YYYY-MM)
    return (b.data.date || '').localeCompare(a.data.date || '');
  });
---
<BaseLayout title="All Work — John Dutamby" locale={locale}>
  <h1 class="font-display text-4xl mb-8">{t('work.allWork.title', locale)}</h1>
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {sortedWorks.map((w) => (
      <WorkCard
        href={`/work/${w.id}`}
        company={w.data.title.split(' — ')[0] ?? ''}
        role={w.data.role}
        title={w.data.summary}
        cover={w.data.cover}
        coverAlt={w.data.title}
        locale={locale}
      />
    ))}
  </div>
</BaseLayout>
