---
import CVExperienceItem from './CVExperienceItem.astro';
import { getCollection } from 'astro:content';

const lang = Astro.currentLocale || 'fr';
const experiences = await getCollection('experiences', (e) => e.id.endsWith(`-${lang}.mdx`));
// sort by optional `order`, lower first, then fallback to created order
const sorted = experiences
  .slice()
  .sort((a, b) => {
    const ao = a.data.order ?? Number.POSITIVE_INFINITY;
    const bo = b.data.order ?? Number.POSITIVE_INFINITY;
    if (ao !== bo) return ao - bo;
    return a.id.localeCompare(b.id);
  });
---
<div class="cv-container">
  <div class="cv-intro">
    <div class="cv-skills">
      <h3 class="cv-section-title">{lang === 'fr' ? 'Compétences clés' : 'Core Expertise'}</h3>
      <div class="skills-grid">
        <div class="skill-category">
          <h4 class="skill-title">{lang === 'fr' ? 'Design' : 'Design'}</h4>
          <p class="skill-description">{lang === 'fr' ? 'Recherche utilisateur, prototypage, design system, stratégie' : 'User research, prototyping, design systems, strategy'}</p>
        </div>
        <div class="skill-category">
          <h4 class="skill-title">{lang === 'fr' ? 'Produit' : 'Product'}</h4>
          <p class="skill-description">{lang === 'fr' ? 'Roadmaps, validation du product-market fit, entretiens utilisateurs' : 'Roadmaps, PMF validation, user interviews'}</p>
        </div>
        <div class="skill-category">
          <h4 class="skill-title">{lang === 'fr' ? 'Leadership' : 'Leadership'}</h4>
          <p class="skill-description">{lang === 'fr' ? "Management d’équipe, vision design, direction stratégique" : 'Team management, design vision, strategic direction'}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="cv-experiences">
    <h3 class="cv-section-title">{lang === 'fr' ? 'Expériences clés' : 'Key Experiences'}</h3>
    <div class="timeline">
      {sorted.map(({ data }) => (
        <CVExperienceItem
          role={data.role}
          period={data.period}
          description={data.description}
          tags={data.tags}
          logoSrc={data.logoSrc}
          logoAlt={data.logoAlt}
        />
      ))}
    </div>
  </div>
</div>


