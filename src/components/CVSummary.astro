---
import CVExperienceItem from './CVExperienceItem.astro';
import { getCollection } from 'astro:content';

const experiences = await getCollection('experiences');
// sort by optional `order`, lower first, then fallback to created order
const sorted = experiences
  .slice()
  .sort((a, b) => {
    const ao = a.data.order ?? Number.POSITIVE_INFINITY;
    const bo = b.data.order ?? Number.POSITIVE_INFINITY;
    if (ao !== bo) return ao - bo;
    return a.id.localeCompare(b.id);
  });
---
<div class="cv-container">
  <div class="cv-intro">
    <div class="cv-skills">
      <h3 class="cv-section-title">Core Expertise</h3>
      <div class="skills-grid">
        <div class="skill-category">
          <h4 class="skill-title">Design</h4>
          <p class="skill-description">Recherche utilisateur, prototypage, design system, stratégie</p>
        </div>
        <div class="skill-category">
          <h4 class="skill-title">Produit</h4>
          <p class="skill-description">Roadmaps, validation du product-market fit, entretiens utilisateurs</p>
        </div>
        <div class="skill-category">
          <h4 class="skill-title">Leadership</h4>
          <p class="skill-description">Management d’équipe, vision design, direction stratégique</p>
        </div>
      </div>
    </div>
  </div>

  <div class="cv-experiences">
    <h3 class="cv-section-title">Expériences clés</h3>
    <div class="timeline">
      {sorted.map(({ data }) => (
        <CVExperienceItem
          role={data.role}
          period={data.period}
          description={data.description}
          tags={data.tags}
          logoSrc={data.logoSrc}
          logoAlt={data.logoAlt}
        />
      ))}
    </div>
  </div>
</div>


