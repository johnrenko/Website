---
import BaseLayout from "../layouts/BaseLayout.astro";
import HeroHeader from "../components/HeroHeader.astro";
import ExperimentsGrid from "../components/ExperimentsGrid.astro";
import { getCollection } from 'astro:content';
import CVSummary from "../components/CVSummary.astro";
import WorkCard from "../components/WorkCard.astro";
const works = await getCollection('work');
const sortedWorks = works
  .slice()
  .sort((a, b) => {
    const orderA = typeof a.data.order === 'number' ? a.data.order : Number.POSITIVE_INFINITY;
    const orderB = typeof b.data.order === 'number' ? b.data.order : Number.POSITIVE_INFINITY;
    if (orderA !== orderB) return orderA - orderB; // lower order first
    // Fallback: most recent date first (date is YYYY-MM)
    return (b.data.date || '').localeCompare(a.data.date || '');
  });
const experiments = await getCollection('experiments');
---
<BaseLayout title="John Dutamby — Portfolio" >
  <HeroHeader name="JOHN DUTAMBY" />

  <section id="work" class="mb-20">
    <div class="flex items-end justify-between mb-6">
      <h2 class="font-display text-3xl">Work</h2>
      <a href="/work" class="text-sm underline">All work →</a>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {sortedWorks.slice(0,3).map((w) => (
        <WorkCard
          href={`/work/${w.id}`}
          company={w.data.title.split(' — ')[0] ?? ''}
          role={w.data.role}
          title={w.data.summary}
          cover={w.data.cover}
          coverAlt={w.data.title}
        />
      ))}
    </div>
  </section>

  <section id="experiments" class="mb-20">
    <div class="flex items-end justify-between mb-6">
      <h2 class="font-display text-3xl">Experiments</h2>
      <a href="/experiments" class="text-sm underline">All experiments →</a>
    </div>
    <ExperimentsGrid limit={8} />
  </section>

  <section id="cv" class="mb-24">
    <h2 class="font-display text-3xl mb-4">Curriculum Vitae</h2>
    <CVSummary />
  </section>

  <section id="contact" class="mb-24">
    <h2 class="font-display text-3xl mb-4">Contact</h2>
    <ul class="space-y-2">
      <li><a href="mailto:john.dutamby@..." class="underline">Email</a></li>
      <li><a href="https://www.linkedin.com/in/johndutamby/" class="underline" rel="noopener" target="_blank">LinkedIn</a></li>
    </ul>
  </section>
</BaseLayout>


